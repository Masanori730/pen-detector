// --- UPDATED INFERENCE FUNCTION ---
async function detectObjects(base64Image) {
    const API_KEY = "V3AIzFk49PlsUZXuSgw3"; // <--- PASTE YOUR KEY HERE
    const WORKSPACE = "artorias-lhd8r";
    const WORKFLOW = "detect-count-and-visualize";
    
    // The official 2026 workflow endpoint
    const url = `https://detect.roboflow.com/infer/workflows/${WORKSPACE}/${WORKFLOW}`;

    try {
        const response = await fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                api_key: API_KEY,
                inputs: {
                    image: {
                        type: "base64",
                        value: base64Image
                    }
                }
            })
        });

        if (!response.ok) throw new Error(`HTTP Error: ${response.status}`);
        
        const data = await response.json();
        console.log("Full API Response:", data);

        // Workflows return an array in 'outputs'. We grab the first one.
        let predictions = [];
        if (data.outputs && data.outputs.length > 0) {
            // Look for predictions inside the first output object
            predictions = data.outputs[0].predictions || [];
        }

        displayResults(predictions);
    } catch (error) {
        console.error("Detection Error:", error);
        status.textContent = "Error: " + error.message;
    }
}
